<!doctype html>
<html lang="en">

<head>

    <title>PO | Paper Snowflake Maker</title>
    <meta name="description" content=""/>
    <meta charset="UTF-8">

    <script src="js/StackBlurContext.js"></script>
    <script src="js/base64-binary.js"></script>
    <script src="js/facebook-canvas-post.js"></script>
    <script src="js/DitheredLinearGradientRGB.js"></script>

    <script type="text/javascript">

        window.addEventListener("load", windowLoadHandler, false);


        //for debug messages
        function trace(message) {
            try {
                console.log(message);
            } catch (exception) {
                return;
            }
        }

        function windowLoadHandler() {
            canvasApp();
        }


        function canvasApp() {

            var displayCanvas = document.getElementById("displayCanvas");
            var displayContext = displayCanvas.getContext("2d");
            var displayBackgroundCanvas = document.getElementById("displayBackgroundCanvas");
            var displayBackgroundContext = displayBackgroundCanvas.getContext("2d");

            var boardCanvas = document.getElementById("boardCanvas");
            var boardContext = boardCanvas.getContext("2d");
            var boardBackgroundCanvas = document.getElementById("boardBackgroundCanvas");
            var boardBackgroundContext = boardBackgroundCanvas.getContext("2d");
            var polygonLayer = document.getElementById("polygonLayer");
            var polygonLayerContext = polygonLayer.getContext("2d");

            var displayWidth = displayCanvas.width;
            var displayHeight = displayCanvas.height;
            var boardWidth = boardCanvas.width;
            var boardHeight = boardCanvas.height;

            //off screen canvas used only when exporting image
            var exportCanvas = document.createElement('canvas');
            exportCanvas.width = displayWidth;
            exportCanvas.height = displayHeight;
            var exportCanvasContext = exportCanvas.getContext("2d");

            //off screen canvas
            var snowflakeShapeCanvas = document.createElement('canvas');
            snowflakeShapeCanvas.width = displayWidth;
            snowflakeShapeCanvas.height = displayHeight;
            var snowflakeShapeContext = snowflakeShapeCanvas.getContext("2d");

            var bufferCanvas = document.createElement('canvas');
            bufferCanvas.width = displayWidth;
            bufferCanvas.height = displayHeight;
            var bufferContext = bufferCanvas.getContext("2d");

            //off screen canvas
            var paperShadingCanvas = document.createElement('canvas');
            paperShadingCanvas.width = displayWidth;
            paperShadingCanvas.height = displayHeight;
            var paperShadingContext = paperShadingCanvas.getContext("2d");

            //For testing:
            //document.body.appendChild(paperShadingCanvas);

            //off screen canvas
            var shadowCanvas = document.createElement('canvas');
            shadowCanvas.width = displayWidth;
            shadowCanvas.height = displayHeight;
            var shadowContext = shadowCanvas.getContext("2d");

            //gui elements
            var btnMakeSnowflake = document.getElementById("btnMakeSnowflake");
            var btnReset = document.getElementById("btnReset");
            var btnAdd = document.getElementById("btnAdd");
            var btnUndo = document.getElementById("btnUndo");
            var cbAutoUpdate = document.getElementById("cbAutoUpdate");
            var cbShading = document.getElementById("cbShading");
            var btnShare = document.getElementById("btnShare");
            var btnSave = document.getElementById("btnSave");

            var drawing;
            var mouseX;
            var mouseY;
            //var pmouseX;
            //var pmouseY;
            var triangleHyp;
            var snowflakeRadius;
            var bottomPoint;
            var boardColor;
            var boardColor2;
            var numUndoLevels;
            var DOT_RAD;
            var FIRST_DOT_RAD;
            var dotColor;
            var firstDotColor;
            var dots;
            var polygonLineColor;
            var history;
            var historyLength;
            var dotToDragIndex;
            var urlColor;

            var bgColors1;
            var bgColors2;
            var gradientBackgroundCanvases;

            var shadedSnowflakeCurrent;

            var saveConfirmSeenOnce;

            function getCssValuePrefix(name, value) {
                var prefixes = ['', '-o-', '-ms-', '-moz-', '-webkit-'];

                // Create a temporary DOM object for testing
                var dom = document.createElement('div');

                for (var i = 0; i < prefixes.length; i++) {
                    // Attempt to set the style
                    dom.style[name] = prefixes[i] + value;

                    // Detect if the style was successfully set
                    if (dom.style[name]) {
                        return prefixes[i];
                    }
                    dom.style[name] = '';   // Reset the style
                }
            }

            var gradientPrefix = getCssValuePrefix('backgroundImage', 'linear-gradient(left, #fff, #fff)');
            //trace("gradientPrefix " + gradientPrefix);

            init();


            function init() {
                triangleHyp = 400.0;
                snowflakeRadius = 200.0;

                bgColors = [
                    {
                        name: "blue",
                        start: "#586B87",
                        end: "#85A0CD"
                    },
                    {
                        name: "green",
                        end: "#4ab34e",
                        start: "#267028"
                    },
                    {
                        name: "red",
                        end: "#ff2F2F",
                        start: "#b00000",
                        textBG: "#ef1f1f"
                    },
                    {
                        name: "purple",
                        end: "#ab6cb3",
                        start: "#57305c"
                    },
                    {
                        name: "gold",
                        end: "#f4cF57",
                        start: "#a47F07",
                        textBG: "#d4aF37"
                    },
                    {
                        name: "gray",
                        end: "#e0e0e0",
                        start: "#707070",
                        textBG: "#CCCCCC"
                    },
                    {
                        name: "blue3",
                        start: "#586B87",
                        end: "#a47F07"
                    },
                    {
                        name: "green3",
                        end: "#707070",
                        start: "#267028"
                    },
                    {
                        name: "red3",
                        end: "#707070",
                        start: "#b00000",
                        textBG: "#ef1f1f"
                    },
                    {
                        name: "purple3",
                        end: "#222222",
                        start: "#57305c"
                    },
                    {
                        name: "gold3",
                        end: "#111111",
                        start: "#a47F07",
                        textBG: "#d4aF37"
                    },
                    {
                        name: "gray3",
                        end: "#ffffff",
                        start: "#707070",
                        textBG: "#CCCCCC"
                    },
                    {
                        name: "blueB",
                        start: "#586B87",
                        end: "#267028"
                    },
                    {
                        name: "greenB",
                        end: "#b00000",
                        start: "#267028"
                    },
                    {
                        name: "redB",
                        end: "#57305c",
                        start: "#b00000",
                        textBG: "#ef1f1f"
                    },
                    {
                        name: "purpleB",
                        end: "#a47F07",
                        start: "#57305c"
                    },
                    {
                        name: "goldB",
                        end: "#707070",
                        start: "#a47F07",
                        textBG: "#d4aF37"
                    },
                    {
                        name: "grayB",
                        end: "#586B87",
                        start: "#707070",
                        textBG: "#CCCCCC"
                    }
                ];

                drawGradientBackgrounds();
                setBgColor(0);
                setUpColorButtons();


                numUndoLevels = 10;
                DOT_RAD = 6.5;
                FIRST_DOT_RAD = 10;
                dotColor = "rgba(255,0,0,0.5)";
                firstDotColor = "rgba(16,220,0,0.5)";
                polygonLineColor = "rgba(0,0,0,0.75)";

                urlColor = "#FFFFFF";

                drawShading();
                drawTriangle();
                //drawSnowflake();

                shadedSnowflakeCurrent = false;

                saveConfirmSeenOnce = false;

                dots = [];

                history = {};
                addCurrentBoardToHistory();
                historyLength = 1;

                setUndoButtonInactive();

                btnMakeSnowflake.addEventListener("click", btnMakeSnowflakeHandler, false);
                btnUndo.addEventListener("click", btnUndoHandler, false);
                btnReset.addEventListener("click", btnResetHandler, false);
                btnAdd.addEventListener("click", btnAddHandler, false);
                cbShading.addEventListener("click", cbShadingListener, false);
                polygonLayer.addEventListener("mousedown", mouseDownHandler, false);
                btnSave.addEventListener("click", btnSaveListener, false);
                btnShare.addEventListener("click", btnShareHandler, false);

                document.getElementById("boardCanvas").style.display = "none";
                document.getElementById("polygonLayer").style.display = "none";
            }

            function setBgColor(index) {
                boardColor = bgColors[index].start;
                boardColor2 = bgColors[index].end;
                paintBackgroundColors(index);
            }

            function setUpColorButtons() {
                var colorButtonPanel = document.getElementById("colorButtonPanel");
                for (var i = 0; i < bgColors.length; i++) {
                    var colorButton = document.createElement("input");
                    //Assign different attributes to the element.
                    //type="button" class="button1" id="btnUndo" value="undo" title="undo"
                    colorButton.setAttribute("type", "button");
                    colorButton.setAttribute("value", "");
                    colorButton.setAttribute("title", bgColors[i].name);
                    colorButton.index = i;
                    colorButton.className = "colorButton";

                    //colorButton.style.background = bgColors[i].end;
                    //colorButton.style.border = "2px solid " + bgColors[i].start;

                    colorButton.style.backgroundImage = gradientPrefix + "linear-gradient(" + bgColors[i].start + ", " + bgColors[i].end + ")";
                    if (!colorButton.style.backgroundImage) {
                        trace("gradient button background doesn't work, setting flat color.");
                        colorButton.style.background = bgColors[i].end;
                    }
                    // for IE 6 - 9:
                    colorButton.style.filter = "progid:DXImageTransform.Microsoft.gradient(startColorStr='" + bgColors[i].start + "', EndColorStr='" + bgColors[i].end + "')";


                    colorButton.addEventListener("click", colorButtonClickHandler, false);

                    colorButtonPanel.appendChild(colorButton);
                }
            }

            function drawGradientBackgrounds() {
                gradientBackgroundCanvases = [];
                for (var i = 0; i < bgColors.length; i++) {
                    var gradCanvas = document.createElement('canvas');
                    gradCanvas.width = displayWidth;
                    gradCanvas.height = displayHeight;
                    var gradContext = gradCanvas.getContext("2d");
                    var dgrad = new DitheredLinearGradient(-20, -20, -20 + 460 * Math.sin(3 * Math.PI / 8), -20 + 460 * Math.sin(3 * Math.PI / 8));
                    var col = hexToRgb(bgColors[i].start);
                    var col2 = hexToRgb(bgColors[i].end);
                    dgrad.addColorStop(0, col2.r, col2.g, col2.b);
                    dgrad.addColorStop(1, col.r, col.g, col.b);
                    dgrad.fillRect(gradContext, 0, 0, displayWidth, displayHeight);
                    gradientBackgroundCanvases.push(gradCanvas);
                }
            }

            function colorButtonClickHandler(evt) {
                //alert(this.index);
                paintBackgroundColors(this.index);
            }

            function paintBackgroundColors(index) {
                drawBoardBackground(index);
                drawDisplayBackground(index);
                titleText.style.background = bgColors[index].start;
                if (!bgColors[index].textBG) {
                    urlText.style.background = bgColors[index].end;
                } else {
                    urlText.style.background = bgColors[index].textBG;
                }
                // urlText.style.background = bgColors[index].start;
            }

            function drawBoardBackground(index) {
                boardBackgroundContext.fillStyle = bgColors[index].start;
                boardBackgroundContext.fillRect(0, 0, displayWidth, displayHeight);
            }

            function drawDisplayBackground(index) {
                /*
                var dgrad = new DitheredLinearGradient(-20,-20,-20+460*Math.sin(3*Math.PI/8),-20+460*Math.sin(3*Math.PI/8));
                var col = hexToRgb(boardColor);
                var col2 = hexToRgb(boardColor2);
                dgrad.addColorStop(0,col2.r,col2.g,col2.b);
                dgrad.addColorStop(1,col.r,col.g,col.b);
                dgrad.fillRect(displayBackgroundContext,0,0,displayWidth,displayHeight);
                */

                //copy from pre-computed canvas
                displayBackgroundContext.drawImage(gradientBackgroundCanvases[index],
                    0, 0, displayWidth, displayHeight,
                    0, 0, displayWidth, displayHeight);
            }

            function setUndoButtonInactive() {
                //btnUndo.style.backgroundColor="#DDD";
                btnUndo.className = "button1_inactive";
            }

            function setUndoButtonActive() {
                //btnUndo.style.backgroundColor="#666";
                btnUndo.className = "button1";
            }

            function mouseDownHandler(evt) {
                var numDots = dots.length;
                var i;
                var found;
                getMousePosition(evt);

                if (!drawing) {
                    //check if mouse down was on an existing dot, and if so set drag behavior
                    i = 0;
                    found = false;
                    while ((!found) && (i < numDots)) {
                        if (dots[i].mouseOverMe()) {
                            found = true;
                            dotToDragIndex = i;
                        }
                        i++;
                    }
                    if (found) {
                        //
                        window.addEventListener("mousemove", mouseMoveWhileDragging, false);
                        window.addEventListener("mouseup", endDrag, false);
                    }
                    //otherwise start drawing a new polygon
                    else {
                        dots = [];
                        drawing = true;
                        var newDot = new Dot(mouseX, mouseY, firstDotColor);
                        newDot.rad = FIRST_DOT_RAD;
                        dots.push(newDot);
                        updatePolygonDrawing();
                        window.addEventListener("mousemove", mouseMoveWhileDrawing, false);
                    }
                } else {
                    //check if mouse down was on first dot
                    if (dots[0].mouseOverMe() && (dots.length > 2)) {
                        closeShape();
                    } else {
                        var newDot = new Dot(mouseX, mouseY, dotColor);
                        dots.push(newDot);
                        updatePolygonDrawing();
                        window.addEventListener("mousemove", mouseMoveWhileDrawing, false);
                    }
                }
            }

            function mouseMoveWhileDragging(evt) {
                evt.stopPropagation();
                evt.preventDefault();
                getMousePosition(evt);
                dots[dotToDragIndex].x = mouseX;
                dots[dotToDragIndex].y = mouseY;
                drawClosedPolygon();
            }

            function endDrag(evt) {
                //go back to previous state before redrawing polygon
                undo(false);
                drawPolygonToBoard();
                addCurrentBoardToHistory();

                if (cbAutoUpdate.checked) {
                    drawSnowflake();
                }

                window.removeEventListener("mousemove", mouseMoveWhileDragging, false);
                window.removeEventListener("mouseup", endDrag, false);
            }

            function updatePolygonDrawing() {
                var i;
                var len;

                polygonLayerContext.clearRect(-1, -1, boardWidth + 2, boardHeight + 2);

                len = dots.length;
                //lines
                polygonLayerContext.strokeStyle = polygonLineColor;
                polygonLayerContext.beginPath();
                polygonLayerContext.moveTo(dots[0].x, dots[0].y);
                for (i = 1; i < len; i++) {
                    polygonLayerContext.lineTo(dots[i].x, dots[i].y);
                }
                if (dots[0].mouseOverMe() && (dots.length > 1)) {
                    //snap
                    polygonLayerContext.lineTo(dots[0].x, dots[0].y);
                    polygonLayerContext.stroke();
                    dots[0].highlight();
                } else {
                    polygonLayerContext.lineTo(mouseX, mouseY);
                    polygonLayerContext.stroke();
                }

                //dots
                for (i = 0; i < len; i++) {
                    dots[i].drawMe();
                }
            }

            function drawClosedPolygon() {
                var i;
                var len;

                polygonLayerContext.clearRect(-1, -1, boardWidth + 2, boardHeight + 2);

                len = dots.length;
                //lines
                polygonLayerContext.strokeStyle = polygonLineColor;
                polygonLayerContext.beginPath();
                polygonLayerContext.moveTo(dots[0].x, dots[0].y);
                for (i = 1; i < len; i++) {
                    polygonLayerContext.lineTo(dots[i].x, dots[i].y);
                }
                polygonLayerContext.lineTo(dots[0].x, dots[0].y);
                polygonLayerContext.stroke();

                //dots
                for (i = 0; i < len; i++) {
                    dots[i].drawMe();
                }
            }

            function closeShape() {
                drawing = false;
                window.removeEventListener("mousemove", mouseMoveWhileDrawing, false);
                drawClosedPolygon();
                //draw polygon to board layer
                drawPolygonToBoard();
                //store history
                addCurrentBoardToHistory();

                shadedSnowflakeCurrent = false;
                if (cbAutoUpdate.checked) {
                    drawSnowflake();
                }
            }

            function cancelDrawing() {
                polygonLayerContext.clearRect(-1, -1, boardWidth + 2, boardHeight + 2);
                dots = [];
                drawing = false;
                window.removeEventListener("mousemove", mouseMoveWhileDrawing, false);
            }

            function btnAddHandler(evt) {
                cancelDrawing();
            }

            function addCurrentBoardToHistory() {
                setUndoButtonActive();

                var historyCanvas = document.createElement('canvas');
                historyCanvas.width = boardWidth;
                historyCanvas.height = boardHeight;
                var historyContext = historyCanvas.getContext("2d");

                //copy current to history
                historyContext.drawImage(boardCanvas,
                    0, 0, boardWidth, boardHeight,
                    0, 0, boardWidth, boardHeight);

                //put in history list, shorten history if necessary
                if (history.first == null) {
                    history.first = historyContext;
                    history.last = historyContext;
                    historyLength = 1;
                } else {
                    historyContext.next = history.first;
                    history.first.prev = historyContext;
                    history.first = historyContext;
                    historyLength++;
                }
                if (historyLength > numUndoLevels + 1) {
                    history.last.canvas = null;
                    history.last.prev.next = null; //(will it be garbage collected?)
                    history.last = history.last.prev;
                    historyLength = numUndoLevels + 1;
                }
            }

            function btnUndoHandler(evt) {
                undo(true);
                dots = [];
            }

            function undo(clearDrawingBoard) {
                if (clearDrawingBoard) {
                    //first clear board of any active lines
                    polygonLayerContext.clearRect(-1, -1, boardWidth + 2, boardHeight + 2);
                }

                if (drawing) {
                    cancelDrawing();
                    return;
                }
                if (historyLength == 1) {
                    //this means the board still has a blank triangle
                    return;
                }

                //first history state will be copy of current so remove it
                history.first.canvas = null;
                history.first.next.prev = null;
                history.first = history.first.next;
                historyLength--;
                boardContext.clearRect(-1, -1, boardWidth + 2, boardHeight + 2);
                boardContext.drawImage(history.first.canvas,
                    0, 0, boardWidth, boardHeight,
                    0, 0, boardWidth, boardHeight);
                if (historyLength == 1) {
                    setUndoButtonInactive();
                }

                if (cbAutoUpdate.checked) {
                    drawSnowflake();
                }

                shadedSnowflakeCurrent = false;
            }

            function btnResetHandler(evt) {
                if (confirm('Estás a punto de comprar una hoja, recordá anotarlo en el balance')) {
                    if (drawing) {
                        cancelDrawing();
                    }
                    dots = [];
                    drawing = false;
                    clearHistory();
                    clearDisplay();
                    drawTriangle();
                    addCurrentBoardToHistory();
                    polygonLayerContext.clearRect(-1, -1, boardWidth + 2, boardHeight + 2);
                    shadedSnowflakeCurrent = false;
                }
            }

            function clearDisplay() {
                displayContext.clearRect(-1, -1, displayWidth + 2, displayHeight + 2);
            }

            function clearHistory() {
                while (historyLength > 0) {
                    history.first.canvas = null;
                    if (historyLength > 1) {
                        history.first.next.prev = null;
                        history.first = history.first.next;
                    } else {
                        history.first = null;
                    }
                    historyLength--;
                }
                setUndoButtonInactive();
            }

            function drawPolygonToBoard() {
                var i;
                var len = dots.length;
                boardContext.fillStyle = "#000000";
                boardContext.beginPath();
                boardContext.moveTo(dots[0].x, dots[0].y);
                for (i = 1; i < len; i++) {
                    boardContext.lineTo(dots[i].x, dots[i].y);
                }
                boardContext.lineTo(dots[0].x, dots[0].y);
                boardContext.fill();
                redToAlphaFilter(boardContext);
            }

            function mouseMoveWhileDrawing(evt) {
                evt.stopPropagation();
                evt.preventDefault();
                getMousePosition(evt);
                updatePolygonDrawing();
            }

            function getMousePosition(evt) {
                var bRect = boardCanvas.getBoundingClientRect();
                mouseX = (evt.clientX - bRect.left) * (boardCanvas.width / bRect.width);
                mouseY = (evt.clientY - bRect.top) * (boardCanvas.height / bRect.height);
            }

            function Dot(_x, _y, _col) {
                this.x = _x;
                this.y = _y;
                this.rad = DOT_RAD;
                this.color = _col;
            }

            Dot.prototype.drawMe = function () {
                polygonLayerContext.fillStyle = this.color;
                polygonLayerContext.beginPath();
                polygonLayerContext.arc(this.x, this.y, this.rad, 0, 2 * Math.PI, false);
                polygonLayerContext.closePath();
                polygonLayerContext.fill();
            }

            Dot.prototype.highlight = function () {
                polygonLayerContext.strokeStyle = this.color;
                polygonLayerContext.beginPath();
                polygonLayerContext.arc(this.x, this.y, this.rad + 2, 0, 2 * Math.PI, false);
                polygonLayerContext.closePath();
                polygonLayerContext.stroke();
            }

            Dot.prototype.mouseOverMe = function () {
                var dx = this.x - mouseX;
                var dy = this.y - mouseY;
                return (dx * dx + dy * dy < this.rad * this.rad);
            }

            function drawTriangle() {
                boardContext.clearRect(-1, -1, boardCanvas.width + 2, boardCanvas.height + 2);
                bottomPoint = {x: Math.floor(boardCanvas.width / 2), y: boardCanvas.height - 20};
                var longLeg = triangleHyp * Math.sqrt(3) / 2;
                boardContext.fillStyle = "#FFFFFF";
                boardContext.strokeStyle = "#FFFFFF";
                boardContext.beginPath();
                boardContext.moveTo(bottomPoint.x, bottomPoint.y);
                boardContext.lineTo(bottomPoint.x - triangleHyp * Math.sin(Math.PI / 12),
                    bottomPoint.y - triangleHyp * Math.cos(Math.PI / 12));
                boardContext.lineTo(bottomPoint.x + longLeg * Math.sin(Math.PI / 12),
                    bottomPoint.y - longLeg * Math.cos(Math.PI / 12));
                boardContext.lineTo(bottomPoint.x, bottomPoint.y);
                boardContext.stroke();
                boardContext.fill();
            }

            function btnMakeSnowflakeHandler(evt) {
                document.getElementById("boardCanvas").style.display = "initial";
                document.getElementById("polygonLayer").style.display = "initial";
                btnResetHandler(evt);
            }

            function drawSnowflake() {
                var scale = snowflakeRadius / triangleHyp;

                //first draw to buffer
                snowflakeShapeContext.clearRect(-1, -1, snowflakeShapeCanvas.width + 2, snowflakeShapeCanvas.height + 2);
                for (var i = 0; i < 6; i++) {
                    snowflakeShapeContext.save();
                    snowflakeShapeContext.translate(displayCanvas.width / 2, displayCanvas.height / 2);
                    snowflakeShapeContext.scale(scale, scale);

                    snowflakeShapeContext.save();
                    snowflakeShapeContext.rotate(i * Math.PI / 3 + Math.PI / 12);
                    snowflakeShapeContext.translate(-bottomPoint.x, -bottomPoint.y);
                    snowflakeShapeContext.drawImage(boardCanvas,
                        0, 0, boardCanvas.width, boardCanvas.height,
                        0, 0, boardCanvas.width, boardCanvas.height);

                    snowflakeShapeContext.restore();
                    snowflakeShapeContext.scale(-1, 1);
                    snowflakeShapeContext.rotate(i * Math.PI / 3 + Math.PI / 12);
                    snowflakeShapeContext.translate(-bottomPoint.x, -bottomPoint.y);
                    snowflakeShapeContext.drawImage(boardCanvas,
                        0, 0, boardCanvas.width, boardCanvas.height,
                        0, 0, boardCanvas.width, boardCanvas.height);
                    snowflakeShapeContext.restore();
                }


                clearDisplay();

                //make shadow
                makeShadow(snowflakeShapeContext, shadowContext);
                //draw shadow to display
                displayContext.drawImage(shadowCanvas,
                    0, 0, displayWidth, displayHeight,
                    0, 0, displayWidth, displayHeight);

                //draw paper shading to buffer
                if (cbShading.checked) {
                    drawShadedSnowflakeToBuffer();
                    displayContext.drawImage(bufferCanvas,
                        0, 0, displayWidth, displayHeight,
                        0, 0, displayWidth, displayHeight);
                    shadedSnowflakeCurrent = true;
                } else {
                    displayContext.drawImage(snowflakeShapeCanvas,
                        0, 0, displayWidth, displayHeight,
                        0, 0, displayWidth, displayHeight);
                    shadedSnowflakeCurrent = false;
                }
            }

            function drawShadedSnowflakeToBuffer() {
                bufferContext.drawImage(paperShadingCanvas,
                    0, 0, displayWidth, displayHeight,
                    0, 0, displayWidth, displayHeight);
                transferAlpha(snowflakeShapeContext, bufferContext);
            }

            function cbShadingListener(evt) {
                if (cbShading.checked) {
                    if (!shadedSnowflakeCurrent) {
                        drawShadedSnowflakeToBuffer();
                        makeShadow(snowflakeShapeContext, shadowContext);
                        shadedSnowflakeCurrent = true;
                    }
                    clearDisplay();
                    displayContext.drawImage(shadowCanvas,
                        0, 0, displayWidth, displayHeight,
                        0, 0, displayWidth, displayHeight);
                    displayContext.drawImage(bufferCanvas,
                        0, 0, displayWidth, displayHeight,
                        0, 0, displayWidth, displayHeight);
                } else {
                    clearDisplay();
                    displayContext.drawImage(shadowCanvas,
                        0, 0, displayWidth, displayHeight,
                        0, 0, displayWidth, displayHeight);
                    displayContext.drawImage(snowflakeShapeCanvas,
                        0, 0, displayWidth, displayHeight,
                        0, 0, displayWidth, displayHeight);
                }
            }

            function makeShadow(sourceContext, destContext) { //manually created shadow for consistent cross-browser performance
                var shadowR = 0;
                var shadowG = 0;
                var shadowB = 0;
                var shadowA = 0.15;
                var shadowOffsetX = 6;
                var shadowOffsetY = 6;
                var shadowBlur = 4;
                var sourceCanvas = sourceContext.canvas;
                var destCanvas = destContext.canvas;

                destContext.clearRect(0, 0, destCanvas.width, destCanvas.height);

                destContext.drawImage(sourceCanvas,
                    0, 0, sourceCanvas.width, sourceCanvas.height,
                    shadowOffsetX, shadowOffsetY, sourceCanvas.width, sourceCanvas.height);

                //Filter: change color to shadow color, multiply alpha by shadow alpha factor
                var imageData = destContext.getImageData(0, 0, destCanvas.width, destCanvas.height);
                var pixelData = imageData.data;
                var len = pixelData.length;
                var i;
                for (i = 0; i < len; i += 4) {
                    if (pixelData[i + 3] != 0) {
                        pixelData[i] = shadowR;
                        pixelData[i + 1] = shadowG;
                        pixelData[i + 2] = shadowB;
                        pixelData[i + 3] *= shadowA;
                    }
                }
                destContext.putImageData(imageData, 0, 0);

                //blur
                stackBlurContextRGBA(destContext, 0, 0, destCanvas.width, destCanvas.height, shadowBlur);
            }

            function drawShading() {
                //var grays = [255,220,194,244,191,240,190,146,240,187,240,170];
                var grays = [255, 242, 234, 250, 233, 249, 232, 217, 249, 232, 249, 234];
                var sideLength = snowflakeRadius + 2;
                var phase = -Math.PI / 2;
                var angleInc = Math.PI / 6;
                paperShadingContext.fillStyle = "#FFFFFF";
                paperShadingContext.fillRect(0, 0, displayWidth, displayHeight);
                paperShadingContext.save();
                paperShadingContext.translate(displayWidth / 2, displayHeight / 2);
                for (var i = 0; i < 12; i++) {
                    paperShadingContext.beginPath();
                    paperShadingContext.moveTo(0, 0);
                    paperShadingContext.fillStyle = gray(grays[i]);
                    paperShadingContext.lineTo(sideLength * Math.cos(phase + i * angleInc), sideLength * Math.sin(phase + i * angleInc));
                    paperShadingContext.lineTo(sideLength * Math.cos(phase + (i + 1) * angleInc), sideLength * Math.sin(phase + (i + 1) * angleInc));
                    paperShadingContext.lineTo(0, 0);
                    paperShadingContext.fill();
                }
                paperShadingContext.restore();

                applyGrayNoise(paperShadingContext, 4);
                stackBlurContextRGB(paperShadingContext, 0, 0, displayWidth, displayWidth, 1.5);
                applyGrayNoise(paperShadingContext, 2);
            }

            function applyGrayNoise(ctx, amt) {
                var canvas = ctx.canvas;
                var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var pixelData = imageData.data;
                var len = pixelData.length;
                var i;
                var val;
                for (i = 0; i < len; i += 4) {
                    val = pixelData[i];
                    val = val + (1 - 2 * Math.random()) * amt;
                    val = Math.floor(val + 0.5);
                    val = (val < 0) ? 0 : ((val > 255) ? 255 : val);
                    pixelData[i] = val;
                    pixelData[i + 1] = val;
                    pixelData[i + 2] = val;
                }
                ctx.putImageData(imageData, 0, 0);
            }

            function applyShading() {

            }

            function gray(value) {
                return "rgb(" + value + "," + value + "," + value + ")";
            }

            function redToAlphaFilter(ctx) {
                var canvas = ctx.canvas;
                var imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var pixelData = imageData.data;
                var len = pixelData.length;
                var i;
                for (i = 0; i < len; i += 4) {
                    pixelData[i + 3] *= pixelData[i] / 255.0;
                    //make white at same time
                    if (pixelData[i] != 255) {
                        pixelData[i] = 255;
                        pixelData[i + 1] = 255;
                        pixelData[i + 2] = 255;
                    }

                }
                ctx.putImageData(imageData, 0, 0);
            }

            function transferAlpha(sourceContext, destContext) {
                //will only work if contexts come from same-sized canvases.
                var sourceCanvas = sourceContext.canvas;
                var sourceImageData = sourceContext.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);
                var sourcePixelData = sourceImageData.data;
                var len = sourcePixelData.length;
                var destImageData = destContext.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);
                var destPixelData = destImageData.data;
                var i;
                for (i = 3; i < len; i += 4) {
                    destPixelData[i] = sourcePixelData[i];
                }
                destContext.putImageData(destImageData, 0, 0);
            }

            function btnShareHandler() {
                drawExportCanvas();
                //   postCanvasToFacebook(exportCanvas, shareTextArea.value)
            }

            /*  function postImageToFacebook(authToken, filename, mimeType, imageData, message) {
                  // this is the multipart/form-data boundary we'll use
                  var boundary = '----ThisIsTheBoundary1234567890';

                  // let's encode our image file, which is contained in the var
                  var formData = '--' + boundary + '\r\n'
                  formData += 'Content-Disposition: form-data; name="source"; filename="' + filename + '"\r\n';
                  formData += 'Content-Type: ' + mimeType + '\r\n\r\n';
                  for (var i = 0; i < imageData.length; ++i) {
                      formData += String.fromCharCode(imageData[i] & 0xff);
                  }
                  formData += '\r\n';
                  formData += '--' + boundary + '\r\n';
                  formData += 'Content-Disposition: form-data; name="message"\r\n\r\n';
                  formData += message + '\r\n'
                  formData += '--' + boundary + '--\r\n';

                  var xhr = new XMLHttpRequest();
                  xhr.open('POST', 'https://graph.facebook.com/me/photos?access_token=' + authToken, true);
                  xhr.onload = xhr.onerror = function () {
                      console.log(xhr.responseText);
                  };
                  xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary=" + boundary);
                  xhr.sendAsBinary(formData);
              }*/

            function drawExportCanvas() {
                //draw elements
                exportCanvasContext.drawImage(displayBackgroundCanvas, 0, 0, displayWidth, displayHeight, 0, 0, displayWidth, displayHeight);
                exportCanvasContext.drawImage(displayCanvas, 0, 0, displayWidth, displayHeight, 0, 0, displayWidth, displayHeight);

                //add printed url to image
                exportCanvasContext.fillStyle = urlColor;
                exportCanvasContext.font = 'bold italic 10px Helvetica, Arial, sans-serif';
                exportCanvasContext.textBaseline = "top";
                var caption = "Made with the paper snowflake maker at www.rectangleworld.com";
                var metrics = exportCanvasContext.measureText(caption);
                exportCanvasContext.fillText(caption, displayWidth - metrics.width - 20, displayHeight);
            }

            /*
            function btnSaveListener(evt) {
                drawExportCanvas();
                if (!saveConfirmSeenOnce) {
                    confirm('The image will open in a new tab or window.\nRight-click (Win) or control-click (Mac) and select "save image as..." to save this image in PNG format.');
                    saveConfirmSeenOnce = true;
                }
                var dataURL = exportCanvas.toDataURL("image/png");
                window.open(dataURL, "snowflakeImage");
            }
            */


            function btnSaveListener(evt) {
                drawExportCanvas();

                //we will open a new window with the image contained within:
                //retrieve canvas image as data URL:
                var dataURL = exportCanvas.toDataURL("image/png");
                //open a new window of appropriate size to hold the image:
                var windowW = Math.max(exportCanvas.width, 500);
                var windowH = Math.max(exportCanvas.height + 50, 500);
                var imageWindow = window.open("", "snowflakeImage", "left=0,top=0,width=" + windowW + ",height=" + windowH + ",toolbar=0,resizable=0");
                //write some html into the new window, creating an empty image:
                imageWindow.document.write("<html><head><title>Export Image</title></head><body>")
                imageWindow.document.write('<p style="font-family: sans-serif; color:#333333; font-size: 10px">Right-click (Win) or control-click (Mac) and select "save image as..." to save this image in PNG format.</p>');
                imageWindow.document.write("<br/>");
                imageWindow.document.write("<img id='exportImage'" +
                    " alt='snowflake image'" +
                    " height='" + displayHeight + "px'" +
                    " width='" + displayWidth + "px'" +
                    " style='width:" + displayWidth + "px;" +
                    "height:" + displayHeight + "px;position:relative; display:block; margin:auto;'/>");
                imageWindow.document.write("</body></html>");
                imageWindow.document.close();
                //copy the image into the empty img in the newly opened window:
                var exportImage = imageWindow.document.getElementById("exportImage");
                exportImage.src = dataURL;

                document.getElementById("boardCanvas").style.display = "none";
                document.getElementById("polygonLayer").style.display = "none";
                clearDisplay();
            }


            //function below from http://stackoverflow.com/questions/5623838/rgb-to-hex-and-hex-to-rgb
            function hexToRgb(hex) {
                var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : null;
            }

        }

    </script>

    <style type="text/css">
        body {
        / / margin: 0 px;
            margin-top: 15px;
            background-color: #ffffff;
            color: #333333;
        }

        h4 {
            font-family: sans-serif;
            color: #333333;
            font-size: 16px;
        }

        h3 {
            font-family: sans-serif;
            color: #333333;
        }

        p {
            font-family: sans-serif;
            color: #333333;
            font-size: 14px;
        }

        a {
            font-family: sans-serif;
            color: #d15423;
            text-decoration: none;
        }

        #grandContainer {
            width: 1060px;
            margin: 0px auto 0px auto;
        / / background: #f00;
        }

        #container {
            width: 810px;
            height: 440px;
            margin: auto;
            padding: 0px;
        / / background: #0CC;
        }

        #container2 {
            width: 810px;
        / / height: 440 px;
            margin: auto;
            padding: 0px;
        / / background: #0CC;
        }

        #displayCanvasHolder {
            width: 440px;
            height: 440px;
            float: left;
        / / margin-left: 100 px;
        / / vertical-align: bottom;
        }

        #boardCanvasHolder {
            float: left;
            width: 250px;
            height: 440px;
            padding-left: 5px;
            margin: 0px;
        / / vertical-align: bottom;
        }

        #buttonPanel {
            position: relative;
            bottom: 0px;
            float: left;
            margin-left: 10px;
            width: 100px;
            height: 440px;
        }

        #buttonPanelContent {
            position: absolute;
            bottom: 0px;
            float: left;
            width: 100px;
            display: inline-block;
        }

        #displayCanvas {
            position: absolute;
            z-index: 1;
        }

        #displayBackgroundCanvas {
            position: absolute;
            z-index: 0;
        }

        #boardCanvas {
            position: absolute;
            z-index: 1;
        }

        #boardBackgroundCanvas {
            position: absolute;
            z-index: 0;
        }

        #polygonLayer {
            position: absolute;
            z-index: 2;
        }

        .colorButton {
            padding: 2px 5px 2px 5px;
            border-radius: 4px;
            border: hidden;
            width: 28px;
            height: 28px;
            margin: 2px;
        }

        .colorButton:active {
            outline: #FF0;
        }

        #colorButtonPanel {
            width: 100px;
            margin: auto;
            text-align: center;
            padding-bottom: 10px;
        }

        .button1 {
            padding: 2px 5px 2px 5px;
            background-color: #666;
            border: 1px solid #666;
            color: #FFF;
            text-decoration: none;
            font-size: 11px;
            outline: none;
            width: 100px;
            margin-top: 5px;
        }

        .button1:active {
            padding: 2px 5px 2px 5px;
            background-color: #995;
            border: 1px solid #995;
            outline: none;
            color: #FFF;
            text-decoration: none;
            font-size: 11px;
        }

        .button1_inactive {
            padding: 2px 5px 2px 5px;
            background-color: #CCC;
            border: 1px solid #CCC;
            outline: none;
            color: #FFF;
            text-decoration: none;
            font-size: 11px;
            width: 100px;
            margin-top: 5px;
        }

        .checkboxes {
            width: 100px;
            margin-left: 100px;
            margin-top: 1px;
        }

        .cbFrame {
            padding: 2px 5px 2px 5px;
            background-color: #666;
            border: 1px solid #666;
            color: #FFF;
            text-decoration: none;
            font-size: 11px;
        }

        ul {
            list-style-type: none;
            padding: 0px;
            margin: 0px;
        }

        input[type="checkbox"] {
            vertical-align: middle;
        }

        label {
            color: #666;
            font-family: sans-serif;
            font-size: 11px;
            display: inline-block;
            vertical-align: middle;
        }

        #savePanel {
            width: 434px;
            margin: 2px 0px 0px 0px;
            padding: 4px;
            color: #FFF;
            font-family: sans-serif;
            font-size: 9px;
            text-align: right;
        }

        #sharePanel {
            position: relative;
            width: 308px;
        }

        #privacyPolicy {
            width: 434px;
            margin: 2px 0px 0px 0px;
            padding: 0px;
            color: #FFF;
            font-family: sans-serif;
            font-size: 9px;
            text-align: right;
        }

        #shareTextArea {
            width: 434px;
            height: 20px;
            color: #666;
            font-family: sans-serif;
            font-size: 9px;
            margin-top: 0px;
            margin-bottom: 0px;
            border-color: #BBD;
            resize: none;
            vertical-align: bottom;
        }

        #shareFooter {
            width: 432px;
            background: #DDF;
            margin: 0px;
            padding: 3px;
            border-bottom: 1px solid #BBD;
            border-left: 1px solid #BBD;
            border-right: 1px solid #BBD;
            color: #FFF;
            font-family: sans-serif;
            font-size: 9px;
            text-align: right;
            margin-top: 0px;
        }

        #btnShare {
            position: relative;
            right: 0px;
            width: 158px;
            border: solid 1px;
            padding: 2px;
            margin-right: 3px;
            border-color: #29447e #29447e #1a356e;
            color: #fff;
            background-color: #5B74A8;
            font-size: 11px;
            font-family: sans-serif;
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#637bad), to(#5872a7));
            background-image: -moz-linear-gradient(#637bad, #5872a7);
            background-image: -o-linear-gradient(#637bad, #5872a7);
            background-image: linear-gradient(#637bad, #5872a7);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#637bad', EndColorStr='#5872a7'); /* for IE 6 - 9 */
            -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8a9cc2;
            -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8a9cc2;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8a9cc2;
        }

        #btnShare:active {
            border-color: #29447E;
            background: #4F6AA3;
            filter: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
            box-shadow: none;
            outline: none;
        }

        #btnMakeSnowflake {
            position: absolute;
            left: 5px;
            width: 158px;
            border: solid 1px;
            padding: 2px;
            margin-right: 5px;
            border-color: #297e44 #297e44 #1a6e35;
            color: #fff;
            background-color: #5BA874;
            font-size: 11px;
            font-family: sans-serif;
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#63ad7b), to(#58a772));
            background-image: -moz-linear-gradient(#63ad7b, #58a772);
            background-image: -o-linear-gradient(#63ad7b, #58a772);
            background-image: linear-gradient(#63ad7b, #58a772);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#63ad7b', EndColorStr='#58a772'); /* for IE 6 - 9 */
            -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8ac29c;
            -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8ac29c;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8ac29c;
        }

        #btnMakeSnowflake:active {
            border-color: #297E44;
            background: #4FA36A;
            filter: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
            box-shadow: none;
            outline: none;
        }

        #btnSave {
            position: absolute;
            left: 255px;
            width: 158px;
            border: solid 1px;
            padding: 2px;
            margin-right: 5px;
            border-color: #297e44 #297e44 #1a6e35;
            color: #fff;
            background-color: #5BA874;
            font-size: 11px;
            font-family: sans-serif;
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#63ad7b), to(#58a772));
            background-image: -moz-linear-gradient(#63ad7b, #58a772);
            background-image: -o-linear-gradient(#63ad7b, #58a772);
            background-image: linear-gradient(#63ad7b, #58a772);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorStr='#63ad7b', EndColorStr='#58a772'); /* for IE 6 - 9 */
            -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8ac29c;
            -moz-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8ac29c;
            box-shadow: 0 1px 0 rgba(0, 0, 0, 0.1), inset 0 1px 0 #8ac29c;
        }

        #btnSave:active {
            border-color: #297E44;
            background: #4FA36A;
            filter: none;
            -webkit-box-shadow: none;
            -moz-box-shadow: none;
            box-shadow: none;
            outline: none;
        }

        #infoPanel {
            display: block;
            width: 810px;
        / / height: 160 px;
        / / background: #0f0;
        / / margin-top: 10 px;
            margin: 10px 0px 0px 0px;
        }

        #shareIcons {
            margin-left: 6px;
            display: inline-block;
            width: 98px;
            font-family: sans-serif;
            color: #333;
            font-size: 10px;
            text-align: center;
            border: 1px solid #CCC;
            padding-top: 5px;
            padding-bottom: 10px;
            right: 0px;
        }

        #shareIcons img {
            margin-left: 0px;
            margin-top: 6px;
        }

        #saveButtonsHolder {
            width: 440px;
            /* height: 100 px;
            / / height: 440 px;
            / / float: left;*/
            margin-bottom: 14px;
            vertical-align: top;
            /* background: #F00;*/
            display: inline-block;
        }

        #instructionsText {
            position: relative;
            width: 250px;
            /* text-align: center;
            / / top: 500 px;
            / / z-index: 1;*/
            font-family: sans-serif;
            color: #333333;
            font-size: 10px;
            display: inline-block;
            margin: 0px 0px 0px 10px;
            vertical-align: top;
            text-align: justify;
            /* background: #5f5;*/
        }

        #titleText {
            width: 100px;
        / / height: 100 px;
            position: relative;
            font-family: Georgia, "Times New Roman", Times, serif;
        / / font-family: sans-serif;
        / / font-style: italic;
        / / color: #666;
            font-size: 16px;
            text-align: center;
        / / border: 1 px solid #48f;
        / / border-radius: 5 px;
            padding-top: 15px;
            padding-bottom: 15px;
            line-height: 1.5;
            background: #586B87;
        / / color: #85A0CD;
            color: white;
        / / text-shadow: black 0.1 em 0.1 em 0.2 em;
        }

        #urlText {
            width: 100px;
            position: relative;
            font-family: Georgia, "Times New Roman", Times, serif;
            font-size: 10px;
            text-align: center;
            padding-top: 8px;
            padding-bottom: 10px;
            line-height: 1.5;
        / / background: #586B87;
        }

        #urlText a {
            width: 100px;
            position: relative;
            font-family: Georgia, "Times New Roman", Times, serif;
            font-size: 11px;
            text-align: center;
            color: #fff;
        }


        #urlText2 {
            width: 100px;
        / / height: 100 px;
            position: relative;
            font-family: Georgia, "Times New Roman", Times, serif;
        / / font-family: sans-serif;
        / / font-style: italic;
        / / color: #666;
            font-size: 16px;
            text-align: center;
        / / border: 1 px solid #48f;
        / / border-radius: 5 px;
            padding-top: 15px;
            padding-bottom: 15px;
            line-height: 1.5;
            background: #586B87;
        / / color: #85A0CD;
            color: white;
        / / text-shadow: black 0.1 em 0.1 em 0.2 em;
        }

        #urlText2 a {
            width: 100px;
            position: relative;
            font-family: Georgia, "Times New Roman", Times, serif;
            font-size: 11px;
            text-align: center;
            color: #fff;
        }

        #urlText3 {
            width: 100px;
        / / height: 100 px;
            position: relative;
            font-family: Georgia, "Times New Roman", Times, serif;
        / / font-family: sans-serif;
        / / font-style: italic;
        / / color: #666;
            font-size: 16px;
            text-align: center;
        / / border: 1 px solid #48f;
        / / border-radius: 5 px;
            padding-top: 15px;
            padding-bottom: 15px;
            line-height: 1.5;
            background: #ff514d;
        / / color: #85A0CD;
            color: white;
        / / text-shadow: black 0.1 em 0.1 em 0.2 em;
        }

        #urlText3 a {
            width: 100px;
            position: relative;
            font-family: Georgia, "Times New Roman", Times, serif;
            font-size: 11px;
            text-align: center;
            color: #fff;
        }

        #colorButtonsLabel {
            width: 100px;
            position: relative;
            font-family: sans-serif;
            font-size: 10px;
            text-align: center;
            color: #888;
        }


    </style>

</head>
<body>


<div id="container">
    <hr>
    <h2 style="text-align: center;">❄️ PAPER SNOWFLAKES ❄️</h2>
    <hr>
    <div id="boardCanvasHolder">
        <canvas id="polygonLayer" width="250px" height="440px"></canvas>
        <canvas id="boardCanvas" width="250px" height="440px"></canvas>
        <canvas id="boardBackgroundCanvas" width="250px" height="440px"></canvas>
    </div>
    <div id="displayCanvasHolder">
        <canvas id="displayCanvas" width="440px" height="440px">Your browser does not support HTML5 canvas.</canvas>
        <canvas id="displayBackgroundCanvas" width="440px" height="440px"></canvas>
    </div>
    <div id="buttonPanel">
        <div id="titleText">Objetivo:</div>
        <div id="urlText"><a> Tener un negocio rentable.</a></div>


        <div id="buttonPanelContent">
            <div id="colorButtonsLabel">Elegí un fondo:</div>
            <hr>
            <div id="colorButtonPanel"></div>
            <ul>
                <li style="display: none"><input type="button" class="button1" id="btnAdd" value="add"
                                                 title="Click to commit the currently drawn polygon (you can also just start drawing a new one)."/>
                </li>
                <li style="display: none"><input type="button" class="button1" id="btnUndo" value="undo" title="undo"/>
                </li>
                <li style="display: none"><input type="button" class="button1" id="btnReset" value="reset"
                                                 title="start over"/></li>

                <li style="display: none"><label title="Creates a folded paper appearance."><input type="checkbox"
                                                                                                   class="checkbox1"
                                                                                                   id="cbShading"
                                                                                                   class="checkboxes"
                                                                                                   checked/>shading
                    on</label></li>
                <li style="display: none"><label
                        title="Causes the snowflake to be redrawn every time you change the triangle."><input
                        type="checkbox" class="checkbox1" id="cbAutoUpdate" class="checkboxes" checked/>auto
                    update</label></li>
            </ul>
        </div>
    </div>
</div>
<div id="container2">
    <!--<div id="instructionsText">
        Para cortar el papel se deben dibujar formas cerradas. Estas formas cerradas representan un corte con
        tijera.
    </div>-->
    <div id="infoPanel">
        <div id="saveButtonsHolder">
            <div id="sharePanel">
                <!--                <textarea id="shareTextArea" name="shareText" rows="2"></textarea>-->
                <div id="shareFooter" style="display: none;"><span style="margin-right:5px; color:#558; font-size:10px">type a message above and then click to share &rarr;</span>
                    <button id="btnShare">Share image on Facebook</button>
                </div>
                <div id="savePanel">
                    <!--                    <span style="margin-right:5px; color:#666; font-size:10px">Guardar Copo &rarr;</span>-->
                    <button id="btnMakeSnowflake">Comprar Hoja</button>
                    <button id="btnSave">Producir Copo</button>
                </div>
                <!--                <div id="privacyPolicy"><span style="margin-right:5px; color:#666; font-size:10px">(This application collects no personal data. See <a-->
                <!--                        href="PrivacyPolicy" target="_blank">privacy policy</a>.)</div>-->
            </div>
            <div id="clear" style="clear:both"></div>
        </div>

        <!--        <div id="shareIcons">-->
        <!--            Share this page:-->
        <!--            <a rel="nofollow"-->
        <!--               href="http://twitter.com/home/?status=Make a virtual paper snowflake at http://rectangleworld.com/PaperSnowflake by @RectangleWorld"><img-->
        <!--                    src="http://www.rectangleworld.com/images/socialmedia32/twitter.png" alt="Tweet This"-->
        <!--                    style="width:32px;height:32px;vertical-align:middle"/></a>-->

        <!--            <a rel="nofollow" href="http://www.facebook.com/sharer.php?u=http://rectangleworld.com/PaperSnowflake/"><img-->
        <!--                    src="http://www.rectangleworld.com/images/socialmedia32/facebook.png" alt="facebook it"-->
        <!--                    style="width:32px;height:32px;vertical-align:middle"/></a>-->

        <!--            <a rel="nofollow"-->
        <!--               href="http://www.stumbleupon.com/submit?url=http://rectangleworld.com/PaperSnowflake/"><img-->
        <!--                    src="http://www.rectangleworld.com/images/socialmedia32/stumbleupon.png" alt="Stumble it"-->
        <!--                    style="width:32px;height:32px;vertical-align:middle"/></a>-->

        <!--            <a rel="nofollow" href="https://plus.google.com/share?url=http://rectangleworld.com/PaperSnowflake/"><img-->
        <!--                    src="http://www.rectangleworld.com/images/socialmedia32/gplus.png" alt="plus one it"-->
        <!--                    style="width:32px;height:32px;vertical-align:middle"/></a>-->
        <!--        </div>-->
    </div>

    <hr>
    <h2 style="text-align: center;">💰 BALANCE 💰</h2>
    <hr>

    <iframe width="100%" height="800"
            src="https://docs.google.com/spreadsheets/d/1kviDR7_BtYYTeG7Tfi8iFUW10pyW2Zjn0-KitwM7edM/edit?usp=sharing?single=false&widget=false&headers=false"
            scrolling="no"></iframe>

</div>
</body>
</html>